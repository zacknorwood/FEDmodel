function [y1] = kb_ABS_final(x1)
%KB_ABS_FINAL neural network simulation function.
%
% Auto-generated by MATLAB, 08-May-2019 13:44:44.
% 
% [y1] = kb_ABS_final(x1) takes these arguments:
%   x = 5xQ matrix, input #1
% With 
%   Row 1: Outdoor temperature in Celsius
%   Row 2: Month [1-12]
%   Row 3: Workday or non-workday [1 = workday, 0 = non-workday] 
%   Row 4: Time of day [1-24, with 24 = 00 is treated as the start of the
%          year, i.e., the first hour of the year has value 24. This since
%          the logged value for that time is primarly between 23 -24 the
%          day before]
%   Row 5: Is the total cooling demand calculated from kb_total_final.m
% and returns:
%   y = 1xQ matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-12.5;0;0;1;0];
x1_step1.gain = [0.0436681222707424;0.166666666666667;2;0.0869565217391304;0.862068965517241];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.5260474750594976712;-2.4835743766831659407;3.2282004449931589463;-4.5513590553979978992;2.6363302634178009676;-2.9208031231080342494;2.8389966763342506795;-3.3128934777536684919;2.9296534727967085132;3.2299627686116436642;3.0567647138311504484;2.1948716538082382321;-1.4109136946072333707;1.6996748300662278819;1.4061024408992730539;2.5819518027157548623;-1.4366958193861336657;-1.7085586811291246789;-1.7802698412529989191;-0.35814537620001218876;0.7888989501758573164;1.4977170704948741253;0.4015321560841524362;-0.33399961470965505717;1.3506849140191268255;-1.353768476792676978;0.16985063213602671905;-0.46904677865489213806;0.20462963542045373155;0.50066997580642869092;-0.62252901151612272113;1.7626875182004126952;1.1092284272423618141;0.9039853743486960802;-1.0253690031470068522;0.29307551062317355184;-0.68159630223629386059;0.77780461945850465355;-1.1968451888367392932;0.91717595768755155738;4.9458407704561109242;2.5176764954288946008;-1.2028227715692725308;2.4478850276014516574;1.3195056811801892938;3.0804285965148068271;3.7365778710457187017;-2.4532021436526538771;-1.5560798596596139287;-2.1323561300472264612;-2.0334840573597241509;5.8129431220308074302;-2.6432067310526536907;1.2989786211374281244;-2.6674373887784197379;-3.4684315460882926274;3.7513765926428237485;-2.4755680804627555602;3.6897502454746109457;-3.0848603171191881778];
IW1_1 = [-0.64934424924747136121 2.2792294911949562142 -1.0340966265708597671 1.2299165470438759851 -2.3114132882512072875;3.0828988270499628754 0.87647606109096520832 2.0599526828022916014 0.15721996455274483973 1.9379734235610057702;2.0236115659409863454 2.5887507111108036817 -2.6803830117016600454 -0.16904966924129441463 -0.013360836446081719373;-0.79366818373015812771 4.1264795325258694092 0.81330975822847662027 1.9213938050701606652 3.7767022906883820355;-3.4879416162383329869 -1.5541411627895296288 -1.8886993515840864166 -0.21276802553075346847 -1.888882378581321797;0.18165892218967713556 0.32413029536205367753 -0.19324820967683750683 -0.050005074169592531041 -3.5389547212337961746;-1.7161485040475101815 -0.94865994193277392021 1.7384564112290574744 -0.65251989271769039735 -0.55360647952530428473;1.0985307289678087894 -2.3896780189453101784 -0.27869021349057770953 -1.6076289881379384195 -0.5634946852038051901;-3.4263932388359519265 -3.6893696283598527152 1.8251854727193150829 1.9808894847317124466 2.1342228154016464892;-3.7198001387365264847 -1.082453543430069498 1.6035458504141535396 -0.40247327086396750273 -2.1369749206523609431;-1.5521509851982775441 1.7180894538030833107 0.53011195576799352569 0.9854011976608001433 2.9000115449702406067;0.26906868320957094687 1.5933796101945576495 1.4656305209703708314 -2.0239973074093340344 0.26263265710486055626;1.4915210063490702552 2.6965590629816884594 -2.5090486910211620142 -0.31914113509298547289 0.34888449112955610687;-1.8891967808664869022 0.96503303167261156315 -2.7430211537645425857 0.31563300891974421791 -1.8087800539551721624;-4.4438032854728435339 -3.1549163203688168622 -1.4146575852691998243 -1.0474792817851037441 -0.8537852075529542839;-1.4099239937299044012 0.40797021201335209595 -1.6716628772140673664 -2.2352347501273359676 2.8301667526363152305;1.4103674737895313118 1.6115984941993450885 2.0894271301769062887 1.591413986478731335 -1.8161956304127719886;0.93460020411262445528 0.41345785659509726173 1.6856055732220101007 -1.0237471622345990507 0.052758572423358594816;1.1335950326713575276 -0.69377261001838097521 -2.4940331348404209955 1.2098019780914002208 0.32753937399288074461;0.64450754788158814979 -1.2857553858865655716 0.56702673869863784439 0.22793537770406832599 0.58922020774717009939;4.2862000931439281359 -3.621059891079969173 1.3722294084410280313 0.75846794642077408621 -1.3917879454116681703;-0.84748046808036869848 1.0644789647690240386 -1.6483678704180082519 -0.79084162259883694635 -1.0281754817926167522;-0.80888133645730120325 1.2846549565386122804 -0.06983679396093459002 0.82082264062597987131 1.3222064108179687469;0.487001381142814882 -3.4471522138588599482 -3.8168051119947263849 -0.059561106225484349019 -3.0612248995989554956;-3.7376525196716960942 -1.2270187908204852612 2.1068628741045016817 -1.9712210929492237632 -1.9619924876136141112;4.3945498405123757379 3.9450111057802597081 2.2077688695243065098 -1.6013929145535683585 1.409160511573632979;2.0255496957843899253 2.4625615685053752202 -0.459995728548784788 -0.049892281440605368292 -0.81638711199507696392;-0.39227102170280092608 -4.2563865337194579652 0.16299916981795872784 -1.4756893761610976323 0.80232752443354948824;3.00345026666177084 3.7594709667155941091 -1.0825244888671312626 0.048044240381307126708 -0.90596686004561244321;-1.6484587370371035497 1.0322079269183865868 1.2589133527025213599 -1.8597166972214163039 0.36187726279943943641;2.445381429886614999 2.9517375808960326644 2.2536594291153915215 -2.9929276672899720602 4.0379329151484935068;2.35116734199996813 -2.6112194085589801595 1.0125655845274463829 -0.015282778998569685608 1.5568511685109682752;0.98301839713726935077 -1.1771266346464099861 2.4790494861382921243 -0.99962223746717082662 -0.96829426792113215683;2.5265414121562179695 1.4986116714486918955 2.5165968203725319619 -1.4232836281817951019 1.3625791593448666195;-0.94663438910743347154 -0.50255742144511017511 0.81433642545474327346 2.3760853574057998472 -1.7433902510913354966;0.75710523272184682142 -0.74699265567767758611 1.0710113977458395329 0.78130243045955072301 0.65959871031561334576;-0.9658250333235770535 -2.1500838207142973779 -1.9904013830877740343 0.051310858532664233023 1.1180784931304623697;0.76744452282868325099 -1.519849821272264867 1.4447084974327906171 -1.3846274378130021265 0.44229942765141233574;-1.4516049172641791731 2.0037204392144412068 1.2523550223195820674 -0.93655600717192410976 0.24406430843370119366;2.9796024256538995445 -3.8719298770695536049 -0.21864423404941513152 -0.96502655999474340476 -1.7628231288207358851;-0.26456769748169006728 5.698841718678111512 -0.1054227818685004453 -0.29113871127203505562 6.4404513900085156308;-2.9336096649890133214 -3.3818459244541632103 -2.2985977958670904542 -0.80007043989468396017 -1.945590979737469306;-2.6802536414686923827 3.5157546570526312379 -0.081754563682487901843 -1.6268176413483033116 1.7824160385176046617;0.70093639079255931623 6.2418744325603503498 3.0090600646867460277 -0.27980830246165883102 0.35271674842629296975;1.3042635445614221279 -1.5890877302207306876 -2.8065274884507238617 1.3515134756243443181 0.31678054315755471704;0.65751307090925159571 0.562841370220623749 2.9466969948558303649 -2.3799954531052511797 1.6936576448845608311;0.15364126750043755054 4.5307672558443705668 -0.10916628961810936893 -0.2777268186886011625 4.702373172436729476;-3.951451068082620921 -4.1024827816893250088 -0.01732370515693154589 -1.6052583355923157882 0.011371140176468204699;-0.66695343405765217248 -0.095165757264925238124 1.1373712173089554067 2.2204722054608470039 -0.76209639636780424077;-0.32805849201541836813 -0.97272992792436685505 2.4170185600744082954 0.2482455834383864024 3.0132074097100205456;-2.5806346276226608261 -0.19860443384018364177 -1.3060681713299373552 -1.7531366024480272703 1.4071979366590547933;0.54805731876130647784 -3.5613410734891468579 0.049696688221608081859 -0.023890778772130510238 4.670746368241848856;-1.829677779054874831 0.93633759580021169722 1.9429191283989661887 0.50393065518525503865 -1.079261380234141976;0.74142121928882775972 -0.52865555660750274125 -1.219043264067896537 0.77940366736405086723 -0.7839024725470897792;-4.3426986836049730201 -0.92559162877154932403 1.8432930685823813999 -1.6545992692618847197 -0.31612988757816978813;0.23325554199334336269 -1.9367869209462451607 0.41422996426295127792 -0.56631638908677772726 -2.7382742565475575169;1.7670791790658439968 3.1217538355006677619 0.75574891790965448291 -1.785310145703139284 -1.3254099875588924995;0.42788634765252597791 0.73383150615814773943 -2.3263458907376768359 -2.3389742759030704988 1.4624491624455884242;2.2634268130136683261 1.1748075190765581155 2.3137801990006590103 0.75000882714944450136 0.97794167375918039653;-1.3103787615616111495 -4.5798625156293004679 2.865200350784550043 -0.59075291953612252271 -1.5366959665013142367];

% Layer 2
b2 = 1.8591640919233725082;
LW2_1 = [-0.42095230810634987062 1.1792710038750109369 2.1667204666211294928 0.34378483030792850172 1.0255971171213744686 0.75145663181753163951 -1.7197775401827197772 -0.40119181599046677134 0.072595956852843937512 0.14652118500008884383 0.60445027407609852599 0.28240357367187052251 1.7812193384281140851 -1.5359636777948579844 0.22557992169595281196 0.21492662780440835446 0.15627358199029423025 1.3609438241547344717 -1.2181338051710344228 2.434208469694326471 -0.14516825836040089803 0.92957768063233181532 0.68140762550699052191 0.93491995658275461878 -0.11979528678937338693 -0.11895993394191539672 -2.5377866044323402761 -0.09888670733986354433 1.0470664296472984578 -0.38971950516806580511 -0.090210962319547199906 0.40335169597043823986 1.5166075856133984789 0.17456619908386911133 0.19082779931872606571 -2.128678140170077171 1.0031842530215073772 -0.63337246838259420034 0.79433119095878090832 0.14531727585141682169 2.0637762211498760223 -0.35330266315687758327 0.084801275704535619693 0.16802477476355529018 -0.93781254432003202659 -0.66479347599643767719 -2.9344813190244813939 0.11783737513621191095 0.27110882573449401889 0.27071871426420418549 -0.21675157443042852856 0.69045060726295126585 1.771825055476073274 1.5830087098942293711 -0.10307108346072535454 -0.89311822940885332578 0.13749134128501833141 0.58235735585226644506 0.58689583866582573091 0.27201680814941420206];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.995024875621891;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
Q = size(x1,2); % samples

% Input 1
xp1 = mapminmax_apply(x1,x1_step1);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = repmat(b2,1,Q) + LW2_1*a1;

% Output 1
y1 = mapminmax_reverse(a2,y1_step1);
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
