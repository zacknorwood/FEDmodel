function [y1] = kb_friskis_final(x1)
%KB_FRISKIS_FINAL neural network simulation function.
%
% Auto-generated by MATLAB, 08-May-2019 22:43:48.
% 
% [y1] = kb_friskis_final(x1) takes these arguments:
%   x = 4xQ matrix, input #1
% With 
%   Row 1: Outdoor temperature in Celsius
%   Row 2: Month [1-12]
%   Row 3: Workday or non-workday [1 = workday, 0 = non-workday] 
%   Row 4: Time of day [1-24, with 24 = 00 is treated as the start of the
%          year, i.e., the first hour of the year has value 24. This since
%          the logged value for that time is primarly between 23 -24 the
%          day before]
% and returns:
%   y = 1xQ matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-12.5;2;0;1];
x1_step1.gain = [0.0436681222707424;0.25;2;0.0869565217391304];
x1_step1.ymin = -1;

% Layer 1
b1 = [-5.5201785873862938558;4.9774271702481582835;4.8954160164393973886;2.4168772978302666132;-4.4434001039804877919;-3.4984964858744436178;-1.7727839202772890381;-4.1599912438991948349;3.4683015750342178762;-3.3782906107192371969;5.2677772197729044734;-2.3888008278890424663;-1.3242318366673933028;-3.2066833680529995831;-2.1713768786568805602;0.99005322728646194541;2.7565666519270819457;2.6513188527499149671;-1.6254859543777999686;-1.5167284286786861802;1.2571240899980200556;-1.4499395742748002469;2.1032756916468104968;2.4313321020409892625;0.17319330359555704102;-1.8927939272381413272;-2.0969464390004688426;2.1635253186731637776;-0.27066652037701000033;-0.3770700473608374903;0.19201700959730202967;-0.2909655999772503554;-0.28210117280588825617;0.50261550499695095695;0.0013760035480542707944;1.1553555081057047538;-1.4026879537429757239;0.40900617870971012202;-0.68515207568594838072;2.5141820253033304589;-1.697775448661787312;-2.3279863141686671923;2.9136141998818887444;-1.5738499770157885482;2.4506090231388917289;-1.326823302502680324;2.0815773359688720667;2.3737970613072234549;-3.0247467327856818464;-2.6856711193640983026;2.2622986919466416822;-2.6084422052309652607;-2.5630418395990495206;3.2932490187314273911;-4.4576205261297605631;4.3302629959192504572;4.0809287100353675015;5.2164904102605955671;5.044959776789456285;-6.0057461594906556002];
IW1_1 = [4.7331054840509034776 3.5892302430796996227 -2.5021893720721113397 1.2878912795699541949;-2.1992979306455389121 -4.1363130735664759285 2.4739529750552700094 1.4615962296492199801;-0.85439822279909349856 -2.0664584743528453536 0.90149661851817264324 -4.4481211647362250972;-3.4815598710027977347 0.93948448486511149103 -2.6856378161853360353 -1.2952163628912871651;6.1814023061722984664 -0.5101974173766365972 -1.4257359985329343122 -2.187487030803458854;1.115073847780904126 -1.9702099384820501715 1.7685853406359139939 -3.3047857417801851376;-0.94161545787657296991 2.2080076813001379143 -0.08497434215152505077 -3.0964790342192562989;5.9986285216695893752 -0.48805985792871880991 -1.2713686230637204488 2.4735185147125968719;-2.6599715119469897751 0.34275475652486625533 -1.9099907777712128443 -3.5317680090127803183;-0.16343302317141950031 -2.8337973753883409778 1.3508322416423217405 -3.404417082991211263;-1.576892729287177275 3.0337569858917650123 -2.8040904206314425373 -3.3779869348898521331;-2.4933728821891092409 3.0570560404143840572 3.245548251780180582 0.52517466843450621994;0.73819985789843667323 2.8168985413499463277 1.2829130819687151188 -4.4370014162690365467;-0.20706327805749374926 2.1503021505041353123 3.5555417748652944354 -2.6057131841203369227;0.64437029080454832908 -2.2599738356441547715 0.01363223667030739536 3.2586932063178046803;0.27848136519292659985 -1.9952310220324778189 -4.2231434763438775448 1.0540932846764556885;-3.5316740147189769061 5.5635035255272953236 3.1918095369844698972 -2.6269983927859459349;-1.6284173786438802534 0.65221086351857771035 0.066274331524390328596 2.9629147004577722768;2.7276583271543772824 1.7424531584379576721 -0.26702861815067485685 0.40343409055295176291;4.2089514817873174835 3.2975136122485144696 -1.6752534458399412909 0.070120244354533706188;-2.8106771291260801426 2.0699490781153668806 -1.2438281670031401394 2.7967435616560734069;9.1954168802049665032 0.33745277066199458327 -0.041029578304048609783 -1.7286114036116579928;-2.0196548418110564782 -1.7142645996550252008 4.0298846926069771257 1.6774426374645172722;-0.69263881122987358552 0.030967411783459158903 5.2365228765511977471 12.873296539384499582;0.73344933838561920947 -5.5286700504549415314 0.65033628602344861758 3.4320605336483906989;2.3772865061792196606 5.9143589050769174165 2.7053370948055528444 -3.5968141206214601091;3.3501981798604276719 1.2638853793861506425 -2.6182308140024379561 4.2685458167880163671;-0.81136913797213594535 -0.000474973342318953844 4.731376818459944289 11.773974892813425797;0.39045518257510886118 -4.3266292877124925553 -5.4068762674269246205 -0.51779228309612823633;-0.61328961756161370911 -0.48368661230990755984 -2.178337231778050942 -2.5487489129219649264;-0.30181282917785673403 1.977450715732658848 -1.084931372858595422 4.4233059455690435513;2.8564652891120614342 -1.5215093247337434512 -1.2803364683688078784 0.67008213683441297803;-3.6147363791464321991 -2.0813495979008544978 2.6684651674155506207 3.2878817026949840319;-3.3896405417460906406 1.6376380801736474258 3.3911755529637570561 1.6886590625164481505;-2.5628923313860032529 -0.66157112378664828523 -3.793103377674820198 -3.011122190676186694;3.5626016960719746329 -0.31415124860495213799 -4.5974791689077756374 1.0334704399504268668;-6.0216088117726096485 1.4760404336947543502 3.2842335205747836824 -0.61348078405918637923;1.6432899849174062989 1.2052524381961680078 0.3259404196544985477 3.8581358655669588664;-5.7550204086183356367 3.7112099016489037417 -2.7187585069023683104 0.51523205168865382486;2.5341583509686058662 -2.210109994328646188 3.7529399818066533356 -0.92911695480103728695;-6.9013669156442967179 2.0245664248568266963 3.6893253300394643901 -1.0102386808507854976;-2.9053669841238640714 3.6996004958188049017 3.455350729579417024 0.7387646531954420448;3.254057260215855063 -2.7421258856473476051 -1.8849347803142915136 -1.5799691593949831692;-1.2202495479999526662 2.4023954028235112723 2.0094047482921846282 -2.1816257804969798606;3.7770606105682831277 2.2613544620852468192 -2.818931821066557486 -0.8848620979267780573;-3.8199621942214894155 -1.5375843776061188795 1.2593809649076292967 -1.9055471123981868597;1.2277777090348711564 0.32573517281882818919 4.1784079796534205897 -4.4348202906555584946;0.22132062121390341791 -1.2737885156929571462 2.8081749156138413603 -0.26714352154494197533;-0.60129768133189398505 0.88389304995845174862 -0.58270929860337028483 5.5474778726864570899;-1.3639741526513544656 -0.25246308446754772703 -5.3532462572471875006 5.6148452790998568673;1.7622301684950834044 -1.4069711917602751861 -2.4112610189710981246 -1.7096616378642754963;-0.82296931713391774377 4.5811239400869379068 -0.41690439191411776676 4.9405437353914098964;-2.051178182514372228 -1.6192329281603918822 -2.4117669373862713478 -1.6047451070121057093;1.9405875344238254776 -4.8061110821145556216 -2.8371422457551189744 2.5481350243413327661;-4.6127497084537791849 4.315599992875033486 2.6785800328632438649 2.7969689277014695428;0.20992236773661465676 1.8640992017586528462 2.2360022815251148209 -3.0314988743831339235;-0.68655989176880949376 2.7063932779030563935 2.8928848099510240388 0.46861813383740896777;0.90931452909721843803 -0.93695834649366394054 3.1461207448528858421 -4.6436067206425901688;-2.2981852534971252133 -0.0044819098704595005528 -1.422874123416296932 -4.0474032377158106755;-0.8936055764524667433 0.86799686613772941701 2.7561840418223964022 4.8608946793972478417];

% Layer 2
b2 = -1.1006322817973561712;
LW2_1 = [-0.47386207412997366495 0.56089368244827042531 0.50941226505470016406 0.62651638965481060151 0.27034247326964316871 -0.63721678450368435254 -0.62621144623115354566 0.36715178338731396801 -0.62429380187778149569 0.13649456088429784417 -1.219529611174104744 1.5159550125626137795 -0.22787726949286357669 1.2709227219662961872 -1.4253371561226817477 1.7178761433818594551 0.32196604467162492913 -0.55394726750036316076 0.57865684527279104277 -0.39722317581225102812 0.90062096024466342659 0.16309010827692124734 0.57271604774651296843 1.7218369539015041525 0.23155828224605282117 0.1428161817666126765 -0.25670946221706669732 -1.7772562878207520676 -1.5177989005333680783 -1.0891316425173167559 0.25644346334513784536 -0.56792225910303106851 -0.34607459999163814324 -0.86208732931958809154 0.65833316202480995916 -2.5918147583663904143 -1.3561046597643358069 0.46907575956099706316 0.27414937082656848366 1.5779679017927570328 1.1130006997407431157 -1.0856639888123871263 -1.1330498738853507223 -1.3070289404823376422 -0.39565339838450991339 0.23051113107457132934 2.0485581656954643393 -4.2082270788803315398 2.4956840769446388961 1.4552400208884146426 2.4148919313861059166 -0.20001061128326805272 0.67946800816944186163 -0.38993517601762961444 -0.64547312226314723649 -1.6758950500072022916 -0.97410013629321978712 3.1009943662077361637 -1.5263953042514297742 -3.2990128832960876615];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 19.9999999999997;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
Q = size(x1,2); % samples

% Input 1
xp1 = mapminmax_apply(x1,x1_step1);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = repmat(b2,1,Q) + LW2_1*a1;

% Output 1
y1 = mapminmax_reverse(a2,y1_step1);
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
